# analyzer/radical_test.py
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

# ===============================
#  –†–ê–î–ò–ö–ê–õ–ò (–±–∞–ª–∏ —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª—ñ)
# ===============================

RADICALS = {
    "zbudlyvyi": 0,
    "demonstratyvnyi": 0,
    "trivozhnyi": 0,
    "pedantychnyi": 0,
    "epileptoid": 0,
    "emotyvnyi": 0,
    "gipertymnyi": 0,
}

# ===============================
#   –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–µ—Å—Ç—É
# ===============================

QUESTIONS = [
    {
        "text": "1Ô∏è‚É£ –û–±–µ—Ä–∏ —Å—Ç–∏–ª—å –æ–¥—è–≥—É:",
        "options": {
            "–°—Ç—Ä–∏–º–∞–Ω–∏–π": {"trivozhnyi": 2, "pedantychnyi": 1},
            "–Ø—Å–∫—Ä–∞–≤–∏–π": {"demonstratyvnyi": 3, "gipertymnyi": 1},
            "–ú—ñ–Ω—ñ–º–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π": {"pedantychnyi": 2},
            "–ï–∫—Å—Ç—Ä–∞–≤–∞–≥–∞–Ω—Ç–Ω–∏–π": {"demonstratyvnyi": 3},
        },
    },
    {
        "text": "2Ô∏è‚É£ –û–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–∞–∂–Ω—ñ –∫–æ–ª—å–æ—Ä–∏:",
        "options": {
            "–¢–µ–º–Ω—ñ": {"trivozhnyi": 2, "pedantychnyi": 1},
            "–°–≤—ñ—Ç–ª—ñ": {"emotyvnyi": 1, "gipertymnyi": 1},
            "–ù–∞—Å–∏—á–µ–Ω—ñ": {"demonstratyvnyi": 2},
            "–ü–∞—Å—Ç–µ–ª—å–Ω—ñ": {"emotyvnyi": 2},
        },
    },
    {
        "text": "3Ô∏è‚É£ –Ø–∫–∞ —Ç–≤–æ—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∞?",
        "options": {
            "–°–ø–æ–∫—ñ–π–Ω–∏–π": {"emotyvnyi": 2},
            "–†—É—Ö–ª–∏–≤–∏–π": {"gipertymnyi": 2},
            "–í–∏–±—É—Ö–æ–≤–∏–π": {"zbudlyvyi": 3, "epileptoid": 1},
            "–ü–æ–≤—ñ–ª—å–Ω–∏–π": {"trivozhnyi": 1},
        },
    },
    {
        "text": "4Ô∏è‚É£ –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è:",
        "options": {
            "–°—Ç—Ä–∏–º–∞–Ω–∏–π": {"trivozhnyi": 2},
            "–î—É–∂–µ –µ–º–æ—Ü—ñ–π–Ω–∏–π": {"emotyvnyi": 3},
            "–õ–∞–∫–æ–Ω—ñ—á–Ω–∏–π": {"epileptoid": 2},
            "–ì–æ–≤—ñ—Ä–∫–∏–π": {"gipertymnyi": 2, "demonstratyvnyi": 1},
        },
    },
    {
        "text": "5Ô∏è‚É£ –†–µ–∞–∫—Ü—ñ—è –Ω–∞ —Å—Ç—Ä–µ—Å:",
        "options": {
            "–ó–∞–º–æ–≤–∫–∞—é": {"trivozhnyi": 3},
            "–í–∏–±—É—Ö–∞—é": {"zbudlyvyi": 3},
            "–ü–æ—á–∏–Ω–∞—é –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏": {"epileptoid": 3},
            "–ü–æ—á–∏–Ω–∞—é –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏": {"pedantychnyi": 3},
        },
    },
    {
        "text": "6Ô∏è‚É£ –®–≤–∏–¥–∫—ñ—Å—Ç—å –º–∏—Å–ª–µ–Ω–Ω—è:",
        "options": {
            "–î—É–∂–µ —à–≤–∏–¥–∫–∞": {"gipertymnyi": 2},
            "–ü–æ–≤—ñ–ª—å–Ω–∞": {"trivozhnyi": 2},
            "–°—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–∞": {"pedantychnyi": 2},
            "–Ü–º–ø—É–ª—å—Å–∏–≤–Ω–∞": {"zbudlyvyi": 2},
        },
    },
    {
        "text": "7Ô∏è‚É£ –Ø–∫ –ø—Ä–∏–π–º–∞—î—à —Ä—ñ—à–µ–Ω–Ω—è?",
        "options": {
            "–ê–Ω–∞–ª—ñ–∑—É—é": {"pedantychnyi": 2},
            "–û–¥—Ä–∞–∑—É —Ä–æ–±–ª—é": {"zbudlyvyi": 2, "gipertymnyi": 1},
            "–†–∞–¥–∂—É—Å—è": {"emotyvnyi": 2},
            "–£–Ω–∏–∫–∞—é —Ä—ñ—à–µ–Ω–Ω—è": {"trivozhnyi": 2},
        },
    },
    {
        "text": "8Ô∏è‚É£ –ñ–∏—Ç—Ç—î–≤—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏:",
        "options": {
            "–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å": {"pedantychnyi": 1, "trivozhnyi": 2},
            "–í–ª–∞–¥–∞": {"epileptoid": 3},
            "–ù–æ–≤–∏–∑–Ω–∞": {"gipertymnyi": 2},
            "–ì–∞—Ä–º–æ–Ω—ñ—è": {"emotyvnyi": 2},
        },
    },
    {
        "text": "9Ô∏è‚É£ –Ø–∫ –≤–∑–∞—î–º–æ–¥—ñ—î—à –∑ –ª—é–¥—å–º–∏?",
        "options": {
            "–î–æ–º—ñ–Ω—É—é": {"zbudlyvyi": 2, "epileptoid": 3},
            "–ü—ñ–¥–ª–∞—à—Ç–æ–≤—É—é—Å—å": {"emotyvnyi": 2},
            "–£–Ω–∏–∫–∞—é": {"trivozhnyi": 2},
            "–í–µ–¥—É –¥—ñ–∞–ª–æ–≥": {"pedantychnyi": 1},
        },
    },
    {
        "text": "üîü –Ø–∫–∞ –µ–º–æ—Ü—ñ—è –¥–æ–º—ñ–Ω—É—î?",
        "options": {
            "–¢—Ä–∏–≤–æ–≥–∞": {"trivozhnyi": 3},
            "–°–ø–æ–∫—ñ–π": {"emotyvnyi": 2},
            "–ê–≥—Ä–µ—Å—ñ—è": {"zbudlyvyi": 2},
            "–†–∞–¥—ñ—Å—Ç—å": {"gipertymnyi": 2},
        },
    },
]


# ===============================
#   –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
# ===============================

def build_keyboard(options: dict, qid: int):
    kb = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text=opt, callback_data=f"rad_{qid}_{opt}")]
            for opt in options.keys()
        ]
    )
    return kb


# ===============================
#   –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
# ===============================

def compute_result(scores: dict):
    sorted_scores = sorted(scores.items(), key=lambda x: x[1], reverse=True)
    top = sorted_scores[0]
    second = sorted_scores[1]

    radical_names = {
        "zbudlyvyi": "–ó–±—É–¥–ª–∏–≤–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "demonstratyvnyi": "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "trivozhnyi": "–¢—Ä–∏–≤–æ–∂–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "pedantychnyi": "–ü–µ–¥–∞–Ω—Ç–∏—á–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "epileptoid": "–ï–ø—ñ–ª–µ–ø—Ç–æ—ó–¥–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "emotyvnyi": "–ï–º–æ—Ç–∏–≤–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
        "gipertymnyi": "–ì—ñ–ø–µ—Ä—Ç–∏–º–Ω–∏–π —Ä–∞–¥–∏–∫–∞–ª",
    }

    return f"""
üß† **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç—É —Ä–∞–¥–∏–∫–∞–ª—ñ–≤**

### ü•á –î–æ–º—ñ–Ω—É—é—á–∏–π —Ä–∞–¥–∏–∫–∞–ª: **{radical_names[top[0]]}** ({top[1]} –±–∞–ª—ñ–≤)
### ü•à –î—Ä—É–≥–æ—Ä—è–¥–Ω–∏–π: **{radical_names[second[0]]}** ({second[1]} –±–∞–ª—ñ–≤)

---

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Ä–∞–¥–∏–∫–∞–ª—ñ–≤ —è –¥–æ–¥–∞–º —É —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –º–æ–¥—É–ª—å, —â–æ–± –±–æ—Ç –≤–∏–¥–∞–≤–∞–≤ –ø–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å.

"""